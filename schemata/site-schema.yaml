# Author: Erik Quaeghebeur
# Date: 2018-11-27

# HEADER
$schema: "http://json-schema.org/draft-07/schema#"
  # NOTE: consult the above-referenced site for the schema language definition
$id: "https://bitbucket.org/equaeghe/pseudo_gradients-code/\
                                         src/master/schemata/site-schema.yaml#"
  # TODO: the $id uri must point to a git tag, ideally
title: Wind farm site description
type: object
required:
  - uuid
  - rotor_constraints
  - radius
  - parcels
additionalProperties: false

# PROPERTIES
properties:
  #~
  uuid:
    title: Universally unique identifier (UUID)
    description: >-
      The UUID should follow RFC 4122.
      It is meant to distinguish different site descriptions.
      This is especially relevant for different versions and variants of the
      same site.
    type: string
    pattern: ^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$
  #~
  name:
    description: >-
      The name of the wind farm site
    type: string
  #~
  particulars:
    description: >-
      A list of relevant pieces of information, such as further site
      description and details about the choices made in the ‘parcels’ and
      ‘boundaries’ formulations.
    type: array
    uniqueItems: true
    minItems: 1
    items:
      type: str
  #~
  location:
    title: Site location
    description: >-
      The geographical location of the center of the smallest covering disc
    $ref: "location-schema.yaml"
  #~
  radius:
    title: Site radius [km]
    description: >-
      This is the radius in km of the smallest disc covering the site. Four
      fractional digits must be given. (Otherwise the trailing significant
      digits are assumed to be 0.) This radius is used to make all site
      distances adimensional and give a single-value indication of its size.
      Specifying distances adimensionally makes it easy to scale sites by just
      changing this property.
    type: number
    exclusiveMinimum: 0
  #~
  rotor_constraints:
    description: >-
      Whether the site description constrains the tower location or also the
      rotor. If ‘false’, only the tower is constrained. If ‘true’ also the
      rotor is constrained. In the last case, this means the tower must be
      placed at least a rotor radius inside the site away from the boundary.
    type: boolean
  #~
  parcels:
    title: Parcels
    description: >-
      A set of recursively defined parcels.
    type: array
    uniqueItems: true
    minItems: 1
    items:
      $ref: "#/definitions/area_nesting"
  #~
  boundaries:
    title: Site boundaries
    description: >-
      A nested set of boundaries useful for visualizing the farm boundaries.
    type: array
    uniqueItems: true
    minItems: 1
    items:
      $ref: "#/definitions/boundary_nesting"
  #~
  roughness:
    title: Roughness length [m]
    type: number
    exclusiveMinimum: 0

# DEFINITIONS
definitions:
  # NOTE: Any of these definitions can be externalized (to a file) for
  # convenient reuse
  #~
  area_nesting:
    type: object
    required:
      - constraints
    additionalProperties: false
    properties:
      constraints:
        description: >-
          A list of constraints describing a piecewise quadratically bounded
          set.
        type: array
        uniqueItems: true
        minItems: 1
        items:
          $ref: "#/definitions/constraint"
      exclusions:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          $ref: "#/definitions/area_nesting"
  #~
  constraint:
    title: Quadratic constraint
    description: >-
      A representation of a quadratic constraint in terms of coefficients
      of a quadratic multinomial expression in the coordinate variables
      x and y. These variables form a coordinate pair as described in
      "#/definitions/coordinates".
      The expression must be negative (positive) for points inside (outside)
      the site. Points on the border, for which the expression is zero, are
      by default assumed to lie inside the site. (This means that it is assumed
      turbines can be placed on the site border.)
    type: object
    required:
      - "1"
      - oneOf: ["x", "y", "xy", "xx", "yy"]
    additionalProperties: false
    properties:
      border_included:
        description: Whether or not the border is included in the site.
        type: boolean
        default: true
      "1":
        description: The constant term in the expression
        $ref: "#/definitions/coefficient"
      "x":
        description: The coefficient of x in the expression
        $ref: "#/definitions/coefficient"
      "y":
        description: The coefficient of y in the expression
        $ref: "#/definitions/coefficient"
      "xy":
        description: The coefficient of xy in the expression
        $ref: "#/definitions/coefficient"
      "xx":
        description: The coefficient of x² in the expression
        $ref: "#/definitions/coefficient"
      "yy":
        description: The coefficient of y² in the expression
        $ref: "#/definitions/coefficient"
  #~
  coefficient:
    description: >-
      A coefficient value must be given with six significant digits.
      (Significant trailing zeros may be omitted, but are assumed.)
    type: number
    default: 0
  #~
  boundary_nesting:
    type: object
    required:
      - boundary
    additionalProperties: false
    properties:
      boundary:
        description: >-
          A list of vertices describing a (possibly degenerate) piecewise
          linear—so polygonal—boundary.
          It is described in counterclockwise fashion, so inside is on the left
          and outside on the right.
        type: array
        uniqueItems: true
        minItems: 1
        items:
          title: Vertex coordinates
          $ref: "#/definitions/coordinates"
      exclusions:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          $ref: "#/definitions/boundary_nesting"
  #~
  coordinates:
    title: Site point coordinates
    description: >-
      A (x,y) pair of Cartesian coordinates describing a point in the site.
      The x-coordinate corresponds to a fraction along the West-East axis,
      so points East (West) of center have a positive (negative) x-coordinate.
      The y-coordinate corresponds to a fraction along the South-North axis,
      so points North (South) of center have a positive (negative)
      y-coordinate.
    type: array
    items:
      - title: x-coordinate
        $ref: "#/definitions/coordinate_value"
      - title: y-coordinate
        $ref: "#/definitions/coordinate_value"
  #~
  coordinate_value:
    description: >-
      A coordinate value must be given with six significant digits.
      (Significant trailing zeros may be omitted, but are assumed.)
    type: number
    minimum: -1
    maximum: 1
